<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåÜ Pollution Absorbing Adaptive Streetlight Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .section { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); margin: 20px 0; padding: 25px; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        h1 { text-align: center; font-size: 2.5em; margin-bottom: 10px; }
        h2 { color: #fff; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.2); }
        th { background: rgba(255,255,255,0.2); }
        #aqi-display { font-size: 3em; font-weight: bold; text-align: center; margin: 20px 0; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; }
        #latest-mq { text-align: center; font-size: 1.2em; }
        form { max-width: 500px; margin: 0 auto; }
        input, textarea, button { width: 100%; padding: 12px; margin: 10px 0; box-sizing: border-box; border: none; border-radius: 8px; font-size: 1em; }
        textarea { height: 120px; resize: vertical; }
        button { background: linear-gradient(45deg, #ff6b6b, #ee5a24); color: white; cursor: pointer; font-weight: bold; transition: transform 0.2s; }
        button:hover { transform: scale(1.02); }
        #graph { background: rgba(0,0,0,0.3); border-radius: 10px; }
        
        /* Mobile responsive styles */
        @media (max-width: 768px) {
            body { padding: 10px; }
            h1 { font-size: 1.8em; }
            h2 { font-size: 1.3em; }
            .section { padding: 15px; margin: 15px 0; }
            #aqi-display { font-size: 2em; padding: 15px; }
            #latest-mq { font-size: 1em; }
            
            /* Responsive table - stack on mobile */
            table, thead, tbody, th, td, tr { display: block; }
            thead tr { position: absolute; top: -9999px; left: -9999px; }
            tr { margin-bottom: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px; }
            td { border: none; position: relative; padding-left: 50%; text-align: right; }
            td:before { content: attr(data-label); position: absolute; left: 10px; width: 45%; padding-right: 10px; text-align: left; font-weight: bold; }
        }
    </style>
</head>
<body>
    <h1>üåÜ Pollution Absorbing Adaptive Lighting Streetlight</h1>
    <p style="text-align: center; opacity: 0.9;">Real-time air quality monitoring with smart purification</p>
    
    <!-- Current AQI -->
    <div class="section">
        <h2>üìä Current Air Quality</h2>
        <div id="aqi-display">AQI: -- | Level: --</div>
        <p id="latest-mq">Latest MQ Sensor Value: --</p>
    </div>
    
    <!-- Real-Time Graph -->
    <div class="section">
        <h2>üìà Real-Time Graph (Last 15 Seconds)</h2>
        <div id="graph"></div>
    </div>
    
    <!-- Gases Table -->
    <div class="section">
        <h2>üß™ Detected Gases & PPM Levels (MQ-135 Sensor)</h2>
        <table id="gas-table">
            <thead>
                <tr><th>Gas/Molecule</th><th>Current Detected</th><th>Normal Air Baseline</th><th>Detection Range (PPM)</th><th>Health Risks</th><th>Streetlight Solution</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td data-label="Gas/Molecule">CO‚ÇÇ (Carbon Dioxide)</td>
                    <td data-label="Current Detected" id="gas-co2">-- ppm</td>
                    <td data-label="Normal Air Baseline">400</td>
                    <td data-label="Detection Range (PPM)">10 - 1000</td>
                    <td data-label="Health Risks">Headaches, fatigue, oxygen deprivation</td>
                    <td data-label="Streetlight Solution">Filtered and diluted by airflow</td>
                </tr>
                <tr>
                    <td data-label="Gas/Molecule">CO (Carbon Monoxide)</td>
                    <td data-label="Current Detected" id="gas-co">-- ppm</td>
                    <td data-label="Normal Air Baseline">&lt;1 ppm</td>
                    <td data-label="Detection Range (PPM)">10 - 1000</td>
                    <td data-label="Health Risks">Poisoning, brain damage, death</td>
                    <td data-label="Streetlight Solution">Captured by activated carbon filter</td>
                </tr>
                <tr>
                    <td data-label="Gas/Molecule">NO‚ÇÇ (Nitrogen Dioxide)</td>
                    <td data-label="Current Detected" id="gas-no2">-- ppm</td>
                    <td data-label="Normal Air Baseline">0.02</td>
                    <td data-label="Detection Range (PPM)">0.1 - 10</td>
                    <td data-label="Health Risks">Respiratory issues, asthma</td>
                    <td data-label="Streetlight Solution">Reduced through filtration system</td>
                </tr>
                <tr>
                    <td data-label="Gas/Molecule">SO‚ÇÇ (Sulfur Dioxide)</td>
                    <td data-label="Current Detected" id="gas-so2">-- ppm</td>
                    <td data-label="Normal Air Baseline">0.005</td>
                    <td data-label="Detection Range (PPM)">0.1 - 10</td>
                    <td data-label="Health Risks">Respiratory irritation, asthma, acid rain</td>
                    <td data-label="Streetlight Solution">Neutralized by alkaline filter media</td>
                </tr>
                <tr>
                    <td data-label="Gas/Molecule">NH‚ÇÉ (Ammonia)</td>
                    <td data-label="Current Detected" id="gas-nh3">-- ppm</td>
                    <td data-label="Normal Air Baseline">0.01</td>
                    <td data-label="Detection Range (PPM)">10 - 300</td>
                    <td data-label="Health Risks">Eye/nose irritation, burns</td>
                    <td data-label="Streetlight Solution">Absorbed by chemical filter media</td>
                </tr>
                <tr>
                    <td data-label="Gas/Molecule">Benzene (C‚ÇÜH‚ÇÜ)</td>
                    <td data-label="Current Detected" id="gas-benzene">-- ppm</td>
                    <td data-label="Normal Air Baseline">0.005</td>
                    <td data-label="Detection Range (PPM)">10 - 1000</td>
                    <td data-label="Health Risks">Cancer, neurotoxicity</td>
                    <td data-label="Streetlight Solution">Trapped by multi-layer filter mesh</td>
                </tr>
                <tr>
                    <td data-label="Gas/Molecule">Toluene (C‚ÇáH‚Çà)</td>
                    <td data-label="Current Detected" id="gas-toluene">-- ppm</td>
                    <td data-label="Normal Air Baseline">0.01</td>
                    <td data-label="Detection Range (PPM)">10 - 1000</td>
                    <td data-label="Health Risks">Dizziness, confusion, liver damage</td>
                    <td data-label="Streetlight Solution">Trapped by multi-layer filter mesh</td>
                </tr>
                <tr>
                    <td data-label="Gas/Molecule">Alcohol (Ethanol)</td>
                    <td data-label="Current Detected" id="gas-alcohol">-- ppm</td>
                    <td data-label="Normal Air Baseline">0</td>
                    <td data-label="Detection Range (PPM)">10 - 500</td>
                    <td data-label="Health Risks">Intoxication, respiratory irritation</td>
                    <td data-label="Streetlight Solution">Dispersed by ventilation fan</td>
                </tr>
                <tr>
                    <td data-label="Gas/Molecule">Acetone (C‚ÇÉH‚ÇÜO)</td>
                    <td data-label="Current Detected" id="gas-acetone">-- ppm</td>
                    <td data-label="Normal Air Baseline">0.02</td>
                    <td data-label="Detection Range (PPM)">10 - 1000</td>
                    <td data-label="Health Risks">Headaches, nausea, CNS depression</td>
                    <td data-label="Streetlight Solution">Removed by activated carbon filter</td>
                </tr>
                <tr>
                    <td data-label="Gas/Molecule">H‚ÇÇS (Hydrogen Sulfide)</td>
                    <td data-label="Current Detected" id="gas-h2s">-- ppm</td>
                    <td data-label="Normal Air Baseline">0</td>
                    <td data-label="Detection Range (PPM)">1 - 100</td>
                    <td data-label="Health Risks">Rotten egg smell, toxicity, death</td>
                    <td data-label="Streetlight Solution">Neutralized by chemical filter</td>
                </tr>
                <tr>
                    <td data-label="Gas/Molecule">Smoke/Particles (PM2.5)</td>
                    <td data-label="Current Detected" id="gas-smoke">-- Œºg/m¬≥</td>
                    <td data-label="Normal Air Baseline">0 - 12 Œºg/m¬≥</td>
                    <td data-label="Detection Range (PPM)">Detects presence</td>
                    <td data-label="Health Risks">Lung/heart disease</td>
                    <td data-label="Streetlight Solution">Captured by fine mesh filter</td>
                </tr>
            </tbody>
        </table>
        <p style="text-align: center; opacity: 0.8; margin-top: 15px;">
            <strong>Note:</strong> MQ-135 sensor detects gas concentrations relative to clean air. PPM = Parts Per Million. Normal air baselines are typical outdoor levels. Some gases have detection ranges above normal air levels due to sensor sensitivity thresholds.
        </p>
    </div>
    
    <!-- Feedback Form (Your Formspree ID Integrated!) -->
    <div class="section">
        <h2>üìù Report Issues</h2>
        <form action="https://formspree.io/f/xvgeqywp" method="POST">
            <input type="text" name="name" placeholder="Your Name *" required>
            <input type="email" name="_replyto" placeholder="Your Email *" required>
            <textarea name="message" placeholder="Describe the problem (e.g., sensor error, streetlight issue) *" required></textarea>
            <button type="submit">üöÄ Send Report</button>
        </form>
        <p style="text-align: center; opacity: 0.8;">Feedback goes straight to admin. Thanks! üôè</p>
    </div>

    <script>
        // Auto-update dashboard every 1s
        function updateAll() {
            fetch('/data')
                .then(r => r.json())
                .then(data => {
                    // AQI Display
                    const aqiEl = document.getElementById('aqi-display');
                    aqiEl.innerHTML = `AQI: ${data.aqi} | ${data.aqi_level}`;
                    aqiEl.style.color = data.aqi_color;
                    
                    document.getElementById('latest-mq').textContent = `MQ Sensor: ${data.latest_mq} (0-1023)`;
                    
                    // Graph (with error handling for Plotly)
                    try {
                        if (typeof Plotly !== 'undefined') {
                            const x = Array.from({length: data.mq_values.length}, (_, i) => 15 - i); // Time ago
                            const trace = { x, y: data.mq_values, type: 'scatter', mode: 'lines+markers', 
                                            line: {color: data.aqi_color, width: 3}, marker: {size: 6} };
                            Plotly.newPlot('graph', [trace], {
                                title: 'Air Pollution Levels (Higher = Worse Air)',
                                xaxis: {title: 'Seconds Ago'},
                                yaxis: {title: 'MQ Value'},
                                plot_bgcolor: 'rgba(0,0,0,0.2)'
                            });
                        }
                    } catch (e) {
                        console.error('Plotly error:', e);
                    }
                    
                    // Update gas levels table
                    if (data.gas_levels) {
                        document.getElementById('gas-co2').textContent = data.gas_levels.co2 + ' ppm';
                        document.getElementById('gas-co').textContent = data.gas_levels.co + ' ppm';
                        document.getElementById('gas-no2').textContent = data.gas_levels.no2 + ' ppm';
                        document.getElementById('gas-so2').textContent = data.gas_levels.so2 + ' ppm';
                        document.getElementById('gas-nh3').textContent = data.gas_levels.nh3 + ' ppm';
                        document.getElementById('gas-benzene').textContent = data.gas_levels.benzene + ' ppm';
                        document.getElementById('gas-toluene').textContent = data.gas_levels.toluene + ' ppm';
                        document.getElementById('gas-alcohol').textContent = data.gas_levels.alcohol + ' ppm';
                        document.getElementById('gas-acetone').textContent = data.gas_levels.acetone + ' ppm';
                        document.getElementById('gas-h2s').textContent = data.gas_levels.h2s + ' ppm';
                        document.getElementById('gas-smoke').textContent = data.gas_levels.smoke + ' Œºg/m¬≥';
                    }
                });
        }
        setInterval(updateAll, 1000);
        updateAll(); // Load immediately
    </script>
</body>
</html>
